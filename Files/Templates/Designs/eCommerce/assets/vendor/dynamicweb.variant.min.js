/*
* dynamicweb.variant.js
* Copyright (c) 2013 Dynamicweb
* http://www.opensource.org/licenses/mit-license.php
*/
(function(e){var t={init:function(t){return this.each(function(){function c(){if(i.find("img.act").length&&i.find("option:selected").val()!=0){i.find('input[name="variantid"]').val(i.find("img.act").data("value")+"."+i.find("option:selected").val())}else{i.find('input[name="variantid"]').val("")}}var n={el_globalCombination:e(".globalCombination"),el_VariantCombinations:e(".VariantCombinations")};var r=e.extend(n,t);var i=e(this);var s=new Array;i.find(r.el_globalCombination).find("div").each(function(){var t=e(this).html().split("|");var n=e(this).data("name");s[n]=new Array;for(var r in t){var i=t[r].split("^");if(i[0]){s[n].push(Array(i[0],i[1],i[2]))}}});var o=new Array;var u=i.find(r.el_VariantCombinations).html().split("|");for(var a in u){if(u[a]){o.push(u[a])}}for(var f in s){if(f=="Sizes"){i.append("<p>"+f+":</p>").append('<select class="input-large"><option value="0">Select '+f+"</option></select>");for(var l in s[f]){i.find("select").append('<option value="'+s[f][l][1]+'">'+s[f][l][0]+"</option>")}}else{i.append("<p>"+f+":</p>");for(var l in s[f]){i.append('<img data-value="'+s[f][l][1]+'" src="/Files'+s[f][l][2]+'" />')}}}s=[];i.find("select").bind("change",function(){i.find("img").removeClass("off");var t=e(this).find("option:selected").attr("value");if(t!=0){var n="";for(var r in o){if(o[r].search(t)!=-1){n+=o[r]}}i.find("img").each(function(){if(n.search(e(this).data("value"))==-1){e(this).addClass("off")}else{e(this).removeClass("off")}})}c()});i.find("img[class!=off]").bind("click",function(){i.find("img").removeClass("act");e(this).addClass("act");var t=e(this).data("value");var n="";for(var r in o){if(o[r].search(t)!=-1){n+=o[r]}}i.find("select option").each(function(){if(n.search(e(this).attr("value"))==-1&&e(this).val()!=0){e(this).attr("disabled","disabled")}else{e(this).removeAttr("disabled")}});c()});})},destroy:function(t){return e(this).each(function(){var t=e(this);t.find("img[class!=off]").unbind("click");t.find("select").unbind("change");return})}};e.fn.variantSelector=function(){var n=arguments[0];if(t[n]){n=t[n];arguments=Array.prototype.slice.call(arguments,1)}else if(typeof n=="object"||!n){n=t.init}else{e.error("Method "+n+" does not exist");return this}return n.apply(this,arguments)};e(".product-tile ul img").hover(function(){var t=e(this).data("path");e(this).parents(".thumbnail").find("img:eq(0)").attr("src",t)},function(){e(this).parents(".thumbnail").find("img:eq(0)").attr("src",e(this).parents(".thumbnail").find("img:eq(0)").data("src"))})})(jQuery)