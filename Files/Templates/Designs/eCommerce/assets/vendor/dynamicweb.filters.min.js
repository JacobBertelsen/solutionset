/*
* dynamicweb.filters.js
* Copyright (c) 2013 Dynamicweb
* http://www.opensource.org/licenses/mit-license.php
*/
if(typeof eCommerce=="undefined"){var eCommerce=new Object}eCommerce.Overlay={backgroundElement:null,textElement:null,text:function(e){var t="";this.ensureLayout();if(!e||!e.length){t=this.textElement.find("span").text()}else{t=e;this.textElement.find("span").text(e)}return t},show:function(e){if(e){e=$(e);this.ensureLayout();this.backgroundElement.appendTo(e);this.textElement.appendTo(e);this.backgroundElement.show();this.textElement.show();this.backgroundElement.animate({opacity:.3},{duration:200,queue:false});this.textElement.animate({opacity:1},{duration:150,queue:false})}},hide:function(){if(this.backgroundElement){this.backgroundElement.hide();this.backgroundElement.css({opacity:0})}if(this.textElement){this.textElement.css({opacity:.5});this.textElement.hide()}},ensureLayout:function(){if(!this.backgroundElement||!this.backgroundElement.length){this.backgroundElement=$('<div id="page-progress-overlay" class="overlay-animated"></div>').css({opacity:0}).hide().appendTo(document.body)}if(!this.textElement||!this.textElement.length){this.textElement=$('<div id="page-progress-overlay-text" class="overlay-animated"><div>'+'<img src="/Admin/Images/Ribbon/UI/Overlay/wait.gif" alt="" title="" /><span> </span></div></div>').css({opacity:.5}).hide().appendTo(document.body)}},initialize:function(){var e=new Image(36,36);e.src="/Admin/Images/Ribbon/UI/Overlay/wait.gif"}};eCommerce.Filters={_pageId:0,_submitTimer:null,_selectProductsText:"",pageId:function(e){if(typeof e!="undefined"&&e!=null){this._pageId=parseInt(e,10)||0}return this._pageId},selectProductsText:function(e){if(typeof e!="undefined"&&e!=null){this._selectProductsText=e.toString()}return this._selectProductsText},initialize:function(){var e=this;var t=function(e,t){var n=0;var r=[];if(t&&t.length){for(var i=0;i<t.length;i++){n=$.query.get(t[i]);if(n!=null&&n.toString().length){r[r.length]=n.toString()}}}if(r.length){$("#"+e).val(r.join(","))}};var n=function(t){var n=false;var r=0,i=0;var s=null;var o=null;var u=0,a=0;var f=function(e,t){var n=$(this);var r=n.parents(".filter-slider-container-wrapper");var i=r.siblings(".filter-slider-to").find(".filter-slider-to-value");var s=r.siblings(".filter-slider-from").find(".filter-slider-from-value");i.html(t.values[1]);s.html(t.values[0])};t=$(t);n=t.attr("data-slider-range")=="true";r=parseInt(t.attr("data-slider-from"))||0;i=parseInt(t.attr("data-slider-to"))||100;u=parseInt(t.attr("data-slider-value-from"))||0;a=parseInt(t.attr("data-slider-value-to"))||100;s=t.next(".filter-slider-value-container");o=$.query.get(s.attr("name"));if(o==null||typeof o=="string"&&!o.length||o==true){s.val("")}else{f.call(t,null,{values:[u,a]})}t.slider({range:n,min:r,max:i,values:[u,a],stop:function(){var t=$(this);var n=t.next(".filter-slider-value-container");var r=[t.slider("values",0),t.slider("values",1)];if(n&&n.length){n.val(r[0]+"-"+r[1]);e.beginSubmit()}},slide:f})};$(".filter-container").each(function(){var e=false;var t=$(this).find("input.filter-option-value");for(var n=0;n<t.length;n++){if(t[n].checked){e=true}}if(!e){$(this).find("input.filter-option-all-value").each(function(){this.checked=true})}});t("lstOrderBy",["SortBy","SortOrder"]);t("lstPageSize",["PageSize"]);$(".filter-slider-container").each(function(){n(this)});$(".list-mode [data-list-mode]").click(function(e){location.search=$.query.set("View",$(e.target).attr("data-list-mode")).toString()})},beginSubmit:function(){var e=this;if(this._submitTimer){clearTimeout(this._submitTimer);this._submitTimer=null}eCommerce.Overlay.show(document.body);this._submitTimer=setTimeout(function(){e.submit()},200)},submit:function(){var e=$("form.form-filters");e.find(':input[value=""]').attr("disabled","disabled");if(e&&e.length){var t={},n="";n=$(":input","form.form-filters").filter(function(){var e=$(this),n=e.attr("name"),r=e.val();if(n=="ID"||n=="GroupID"){return false}if(e.is(":checkbox")&&e.val()){if(!e.prop("checked")){return false}if(t[n]){if(typeof t[n]==="string"){var i=t[n];t[n]=[];t[n].push(i)}t[n].push(r)}else{t[n]=r}}return!e.is(":checkbox")&&e.val()}).serialize();$.map(t,function(e,t){var r=n.length?"&":"",i="";if(typeof e==="array"){i=t+"="+e.join(",")}else{i=t+"="+e}n+=r+i});location.href=location.pathname+(n.length?"?"+n:"")}},onAllChecked:function(e){var t=null;if(e.checked){t=$(e).parents("ul").find("input.filter-option-value");t.each(function(){this.checked=false});this.beginSubmit()}},onCheched:function(e){var t=null;if(e.checked){t=$(e).parents("ul").find("input.filter-option-all-value");if(t&&t.length){t[0].checked=false}}this.beginSubmit()},reoderProducts:function(e){var t="";var n=null;var r=10;var i="",s="";var o="",u="";if(!e)e={};u=$("#lstPageSize :selected").val();o=($("#lstOrderBy :selected").val()||"").split(",");if(!e.orderByField||!e.orderByField.length){i=o&&o.length?o[0]:""}else{i=e.orderByField}if(!e.orderByDirection||!e.orderByDirection.length){s=o&&o.length>1?o[1]:""}else{s=e.orderByDirection}if(typeof e.pageSize=="undefined"||e.pageSize==null){r=parseInt(u,10)}else{r=parseInt(e.pageSize,10)}if(i&&i.length)n=$.query.set("SortBy",i);if(s&&s.length)n=(n||$.query).set("SortOrder",s.toUpperCase());if(r>0)n=(n||$.query).set("PageNum","1").set("PageSize",r.toString());location.search=n.toString().replace(new RegExp("%2B","g"),"+")},compareProducts:function(e){if(!e||!e.length){e=[];$("input.product-compare-selection:checked").each(function(){e[e.length]=$(this).val()})}var t=$("body").data("pageid"),n="&LayoutTemplate=Designs/"+designName+"/Main.html";location.href="/Default.aspx"+$.query.empty().set("ID",t.toString()).set("Compare",e.join(","))+n}};$(document).ready(function(){eCommerce.Overlay.initialize();eCommerce.Filters.initialize();$("input.filter-option-all-value").change(function(e){eCommerce.Filters.onAllChecked(e.target)});$("input.filter-option-value").change(function(e){eCommerce.Filters.onCheched(e.target)});$.each(["#lstOrderBy","#lstPageSize"],function(e,t){$(t).change(function(){eCommerce.Filters.reoderProducts()})});$("button.product-compare-activator").click(function(e){var t=$("input.product-compare-selection:checked").length;e.preventDefault();if(t<2||t>3){alert(eCommerce.Filters.selectProductsText())}else{eCommerce.Filters.compareProducts()}})});$(window).bind("unload",function(){eCommerce.Overlay.hide()})